<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Osano Implementation Review</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Jost:wght@400;700&family=Lato:wght@400;700&display=swap');

    body {
      font-family: 'Lato', sans-serif;
      max-width: 1000px;
      margin: auto;
      padding: 30px;
      background: linear-gradient(to bottom right, #F0E7FA, #ffffff);
      color: #0E0416;
    }

    h1, h2, h3 {
      font-family: 'Jost', sans-serif;
      color: #7A3FF1;
    }

    .section-header {
      margin-top: 40px;
      padding-bottom: 5px;
      border-bottom: 2px solid #7A3FF1;
      font-size: 1.25em;
    }

    .question {
      margin: 20px 0;
      padding: 15px;
      border-left: 6px solid #ccc;
      border-radius: 6px;
      background: #ffffff;
      box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }

    .high-risk { border-color: #F04438; background: #FFE5E5; }
    .medium-risk { border-color: #F79009; background: #FFF5E5; }
    .low-risk { border-color: #12B76A; background: #E5FFE5; }

    label { display: block; margin: 5px 0; }
    textarea {
      width: 100%;
      padding: 8px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: 'Lato', sans-serif;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      background: linear-gradient(90deg, #7A3FF1, #C57EC4);
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 12px rgba(122, 63, 241, 0.3);
    }

    .report {
      background: #ffffff;
      border-left: 6px solid #7A3FF1;
      padding: 25px;
      margin-top: 40px;
      border-radius: 10px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      line-height: 1.7;
    }

    .report ul { padding-left: 20px; }
    .risk-high { color: #F04438; font-weight: bold; }
    .risk-medium { color: #F79009; font-weight: bold; }
    .risk-low { color: #12B76A; font-weight: bold; }

    .qa-summary {
      margin-top: 30px;
      padding: 20px;
      border-radius: 6px;
      background: #F8F8FA;
      border-left: 4px solid #7A3FF1;
      line-height: 1.6;
    }

    .qa-summary h3 {
      margin-top: 0;
    }

    .note-block {
      margin-top: 6px;
      font-style: italic;
      color: #555;
    }

    .note-block a {
      color: #7A3FF1;
      text-decoration: underline;
      font-size: 0.9em;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>Osano Implementation Self-Review</h1>
  <p>Select answers for each implementation best practice question below. Add notes where relevant. At the end, you'll receive a customized report with prioritized recommendations you can export to PDF.</p>

  <form id="reviewForm"></form>
  <div id="report" class="report" style="display:none;"></div>
  <button id="downloadBtn" style="display:none; margin-top:10px;">Download as PDF</button>

  <script>
    const checks = [
      { section: 'Cookie Consent Installation', name: 'inHead', label: 'Is osano.js placed in the "head"?', text: 'Ensure osano.js is placed inside the <head> tag to properly block non-essential scripts before consent is given.', risk: 'high', docLink: 'https://docs.osano.com/' },
      { section: 'Cookie Consent Styling and Classification', name: 'classified', label: 'Are all scripts and cookies properly classified?', text: 'Ensure every script and cookie is categorized appropriately to maintain valid consent enforcement.', risk: 'high', docLink: 'https://docs.osano.com/' }
    ];

    const form = document.getElementById('reviewForm');
    let currentSection = '';
    checks.forEach(({section, name, label, risk}) => {
      if (section !== currentSection) {
        const header = document.createElement('h2');
        header.className = 'section-header';
        header.textContent = section;
        form.appendChild(header);
        currentSection = section;
      }
      const riskClass = risk === 'high' ? 'high-risk' : risk === 'medium' ? 'medium-risk' : 'low-risk';
      const div = document.createElement('div');
      div.className = `question ${riskClass}`;
      div.innerHTML = `
        <strong>${label}</strong>
        <label><input type="radio" name="${name}" value="yes"> Yes</label>
        <label><input type="radio" name="${name}" value="no"> No</label>
        <label for="note-${name}"><em>Optional Notes:</em></label>
        <textarea name="note-${name}" rows="2" placeholder="Add specifics like '_ga is classified as essential, should be analytics'."></textarea>
      `;
      form.appendChild(div);
    });

    const button = document.createElement('button');
    button.type = 'button';
    button.textContent = 'Generate Report';
    button.onclick = generateReport;
    form.appendChild(button);

    function generateReport() {
      const report = document.getElementById('report');
      const downloadBtn = document.getElementById('downloadBtn');

      const unanswered = checks.filter(({ name }) => {
        const radios = document.getElementsByName(name);
        return !Array.from(radios).some(r => r.checked);
      });

      if (unanswered.length > 0) {
        alert('Please answer all questions before generating the report.');
        unanswered.forEach(({ name }) => {
          const questionBlock = document.querySelector(`[name="${name}"]`)?.closest('.question');
          if (questionBlock) {
            questionBlock.style.borderColor = '#F04438';
            questionBlock.style.boxShadow = '0 0 10px rgba(240, 68, 56, 0.4)';
          }
        });
        return;
      }

      const riskBuckets = { high: [], medium: [], low: [], pass: [] };
      let qa = '<div class="qa-summary"><h3>Full Question & Answer Summary</h3><ul>';

      checks.forEach(({name, label, text, risk, section, docLink}) => {
        const value = form[name]?.value;
        const notes = form[`note-${name}`]?.value.trim();
        const answer = value === 'yes' ? '‚úÖ Yes' : value === 'no' ? '‚ùå No' : '‚Äî';
        qa += `<li><strong>${label}</strong><br/>Answer: <em>${answer}</em>${notes ? `<div class="note-block"><strong>Notes:</strong> ${notes}</div>` : ''}</li>`;
        if (value === 'no') {
          riskBuckets[risk].push({ label, text, risk, notes, docLink });
        } else if (value === 'yes') {
          riskBuckets.pass.push({ label, section });
        }
      });

      let html = '<h2>Implementation Review Report</h2>';
      html += '<p>This report summarizes your implementation health by risk priority. Recommendations are grouped accordingly and include any Implementation Manager notes.</p>';

      const renderRiskSection = (title, icon, color, items) => {
        if (!items.length) return '';
        let out = `<h3 style="margin-top:32px;">${icon} ${title}</h3><ul>`;
        items.forEach(item => {
          out += `<li>
            <span class="${color}">${item.label}</span><br/>
            ${item.text}
            ${item.docLink ? `<div class="note-block"><a href="${item.docLink}" target="_blank">View documentation ‚Üó</a></div>` : ''}
            ${item.notes ? `<div class="note-block"><em>Note:</em> ${item.notes}</div>` : ''}
          </li><br/>`;
        });
        out += '</ul>';
        return out;
      };

      html += renderRiskSection('HIGH-RISK Findings', 'üü•', 'risk-high', riskBuckets.high);
      html += renderRiskSection('MEDIUM-RISK Findings', 'üüß', 'risk-medium', riskBuckets.medium);
      html += renderRiskSection('LOW-RISK Findings', 'üü©', 'risk-low', riskBuckets.low);

      if (riskBuckets.pass.length) {
        html += `<h3 style="margin-top:32px;">‚úÖ No Issues Found</h3><ul>`;
        riskBuckets.pass.forEach(({ label, section }) => {
          html += `<li><strong>${label}</strong> ‚Äî No additional action needed (${section})</li>`;
        });
        html += '</ul>';
      }

      html += qa + '</div>';
      report.innerHTML = html;
      report.style.display = 'block';
      downloadBtn.style.display = 'inline-block';
    }
  </script>
</body>
</html>
